{% extends "base.html" %}
    {% block content %}
    <div class="modal fade" id="instruction-delete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" id="media-content">
            <div class="modal-header">
                <button type="button" class="close" id="close-btn" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-box">
                    <h4>Are you want to delete?</h4>
                    <p class="chapter-btns"> </p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="delete-btn-yes" data-dismiss="modal" class="delete-btn-yes btn btn-danger">Yes</button>
                <button id="delete-btn-no" data-dismiss="modal" class="delete-btn-no btn btn-primary">Back</button>
            </div>
        </div>
    </div>
</div>
    <div class="instructionForm">
           {% csrf_token %}
        {{form.as_p}}
          
        <button id="instruction-btn" class=''onclick=createinstruction()>Create</button></div>
       <ol class="instructions"></ol>
<script>
    var token = localStorage.getItem('token')
    var host = window.location.protocol + "//" + window.location.host;
    document.getElementById('nav-instruction').style.opacity = '0.5';
    if (token){
    function createinstruction() {
       var instruction = document.getElementById('id_instruction').value
       console.log(instruction)
       let csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
       fetch(`https://schooltestproject.herokuapp.com/api/instructions/`,
            {
           method: 'POST',
           body: JSON.stringify({ 'note': instruction }),
           headers: {
               'Accept':'application/json',
               'Content-Type': 'application/json',
               'Authorization':'token'+' '+token,
               'X-CSRFToken': csrftoken
           },
       })
       .then(function(response) {
       location.reload();
       })
      }
var list = document.querySelector('.instructions');
function get(){
  var content = ''
  fetch( `https://schooltestproject.herokuapp.com/api/instructions/`,{
      method : 'GET',
      headers : {
        'Authorization':'token'+' '+token 
      },
    }).then(res => { 
      return res.json()})
    .then(data => {
    console.log(data.data)
    data.data.forEach((d, index) => {
      console.log(d.note)
      content += `<div class="cards" id=${d.id}>
        <li class="grade">${d.note} <button class="btn btn-danger btn-sm" id=delete-ins  data-toggle="modal" data-target="#instruction-delete" >Delete</button>  </li> 
       
       </div>`
      })
      list.innerHTML = content;
  })
  
  }
  get();

  function deleteInstruction(id){
    console.log(id)
    fetch( `https://schooltestproject.herokuapp.com/api/instructions/${id}/`,{
      method : 'DELETE',
      headers : {
      'Content-Type': 'application/json',
      'Authorization': 'token' + ' ' + token,
      },
    }).then(res => { 
      get();
    })
  }
let yes_button = document.getElementById('delete-btn-yes')
  let container= document.querySelector('.instructions')
  container.addEventListener('click',(e) =>{
    e.preventDefault();
    let delbutton = e.target.id == 'delete-ins';
    let id = e.target.parentElement.parentElement.id
    console.log(e.target.parentElement.parentElement.id)
    if(delbutton){
      yes_button.setAttribute("onClick", `deleteInstruction(${id})`);
    }
 })
}
else{
  window.location.href = `${host}/404`
}
</script>
{% endblock %}