<!-- var url = 'http://www.site.com/234234234';
var id = url.substring(url.lastIndexOf('/') + 1); -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXAMINATION</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>

    <style>
        .test-container {
            box-shadow: rgb(50 50 93 / 25%) 0px 50px 100px -20px, rgb(0 0 0 / 30%) 0px 30px 60px -30px, rgb(10 37 64 / 35%) 0px -2px 6px 0px inset;
            padding: 1% 3%;
            margin: 3% 12%;
        }

        #counter {
            font-size: 2rem;
            border-radius: 6%;

            width: 9%;
            margin: 1% 80%;
        }

        .instructions li {
            line-height: 200%;
        }

        .instructions h3 {
            text-align: center;
            margin: 3% auto;
        }

        input.fib {
            margin-left: 0.5%;
            border: none;
            border-bottom: 1px gray dashed;
            outline: none;
        }

        input.fib:focus {
            border: none;
            outline: none;
            border-bottom: 1px gray dashed;
        }

        .hr1 {
            margin-left: -3.4%;
            width: 107%;

        }

        .hr2 {
            margin-left: -6%;
            width: 109%;
        }



        .question-direction {
            display: flex;
            flex-direction: row-reverse;
            justify-content: space-around;
        }

        .test-title {
            text-align: center;
            margin-top: 4%;
        }

        input.fib:focus {
            border: none;
            outline: none;
            border-bottom: 1px gray dashed;
        }

        .question-path {
            display: grid;
            grid-template-columns: auto auto auto auto auto;
            text-align: center;
            margin-left: 30%;
            gap: 0%;
            height: 3em;
        }

        .question-path div {
            height: 55%;
            width: 50%;
            padding: 9%;
        }


        .question-direction {
            display: flex;
            flex-direction: row-reverse;
            justify-content: space-around;
        }


        .grey {
            background-color: #CFD2CF;
            border: none;
            border-radius: 5px;
        }

        .red {
            background-color: #FF7878;
            border: none;
            border-radius: 5px;
        }

        .green {
            background-color: #5BB318;
            border: none;
            border-radius: 5px;
        }

        #submit {
            display: none;
        }

        .answer {
            width: 20px;
            height: 20px;
            background-color: #5BB318;
            border: 1px solid rgba(0, 0, 0, .2);
            margin-bottom: 7%;
        }

        .answer p {
            margin: 0% 167%;
            font-size: 15px;

        }

        .un-answer {
            width: 20px;
            height: 20px;
            background-color: #FF7878;
            border: 1px solid rgba(0, 0, 0, .2);
            margin-bottom: 7%;

        }

        .un-answer p {
            margin: 0% 167%;
            font-size: 15px;

        }

        .un-visited {
            width: 20px;
            height: 20px;
            background-color: #CFD2CF;
            border: 1px solid rgba(0, 0, 0, .2);
        }

        .un-visited p {
            margin: 0% 167%;
            font-size: 15px;
        }

        .testreview {
            display: grid;
            grid-template-columns: auto auto auto;
            row-gap: 10%;
            margin-left: 3%;
        }

        .reviewcards {
            background-color: #5c7aea;
            padding: 12%;
            width: 80%;
        }

        @media screen and (max-width:600px) {
            .instructions {
                text-align: justify;
                padding: 7% 7% 0% 2%;
            }

            .question-direction {
                display: flex;
                flex-direction: column-reverse;
                margin: 27%;
                justify-content: normal;
            }

            .question-path {

                width: 117%;
                margin-left: -4%;
                gap: 7%;
                height: 2em;
                margin-top: 13%;
            }

            .question-path div {

                height: 84%;
                width: 84%;
                padding: 7%;
            }

            .answer-data p {
                width: 105%;
            }

            #counter {
                font-size: 1rem;
                width: 18%;
                margin: 3% 77%;
                padding: 0;
            }

            .close {
                margin-left: 93%;
                border: none;
            }

            .delete-box {
                margin-left: 6%;
            }

            .sm-close {
                position: absolute;
                margin: -12% 55%;
            }

        }

        @media screen and (min-width:700px) and (max-width:800px) {

            .question-path {
                display: grid;
                grid-template-columns: auto auto auto auto auto;
                text-align: center;
                width: 26%;
                margin-top: 3%;
                margin-left: 0%;
                gap: 5%;
                height: 2em;
            }


            .question-path div {
                height: 84%;
                width: 84%;
                padding: 5%;
            }


        }

        @media screen and (min-width:700px) and (max-width:800px) {

            .question-path {
                display: grid;
                grid-template-columns: auto auto auto auto auto;
                text-align: center;
                margin-left: 25%;
                margin-top: 1%;
                gap: 0%;
                row-gap: -21%;
                height: 3em;
            }


            .question-path div {
                height: 66%;
                width: 73%;
                padding: 7%;
            }

        }

        .test-container {
            box-shadow: rgb(50 50 93 / 25%) 0px 50px 100px -20px, rgb(0 0 0 / 30%) 0px 30px 60px -30px, rgb(10 37 64 / 35%) 0px -2px 6px 0px inset;
            padding: 1% 3%;
            margin: 3% 12%;
        }

        #counter {
            font-size: 2rem;
            border-radius: 6%;

            width: 9%;
            margin: 1% 80%;
        }

        .instructions li {
            line-height: 200%;
        }

        .instructions h3 {
            text-align: center;
            margin: 3% auto;
        }

        input.fib {
            margin-left: 0.5%;
            border: none;
            border-bottom: 1px gray dashed;
            outline: none;
        }

        input.fib:focus {
            border: none;
            outline: none;
            border-bottom: 1px gray dashed;
        }

        .hr1 {
            margin-left: -3.4%;
            width: 107%;

        }

        .hr2 {
            margin-left: -6%;
            width: 109%;
        }

        .question-path {
            display: grid;
            grid-template-columns: auto auto auto auto;
            text-align: center;
            width: 16%;
            margin-left: 30%;
            gap: 5%;
            height: auto;
        }

        .question-direction {
            display: flex;
            flex-direction: row-reverse;
            justify-content: space-around;
        }

        .test-title {
            text-align: center;
            margin-top: 4%;
        }

        input.fib:focus {
            border: none;
            outline: none;
            border-bottom: 1px gray dashed;
        }

        .question-path {
            display: grid;
            grid-template-columns: auto auto auto auto;
            text-align: center;
            width: 16%;
            margin-left: 30%;
            gap: 5%;
            height: auto;
        }

        .question-path div {
            width: 64%;
            /* padding: 36% 4%; */
        }

        .question-direction {
            display: flex;
            flex-direction: row-reverse;
            justify-content: space-around;
        }


        .grey {
            background-color: #CFD2CF;
            border: none;
            border-radius: 5px;
        }

        .red {
            background-color: #FF7878;
            border: none;
            border-radius: 5px;
        }

        .green {
            background-color: #5BB318;
            border: none;
            border-radius: 5px;
        }

        #submit {
            display: none;
        }

        .answer {

            width: 20px;

            height: 20px;

            background-color: #5BB318;

            border: 1px solid rgba(0, 0, 0, .2);

            margin-bottom: 7%;



        }

        .answer p {

            margin: 0% 167%;

        }

        .un-answer {

            width: 20px;

            height: 20px;

            background-color: #FF7878;

            border: 1px solid rgba(0, 0, 0, .2);



            margin-bottom: 7%;

        }

        .un-answer p {

            margin: 0% 167%;

        }

        .un-visited {

            width: 20px;

            height: 20px;

            background-color: #CFD2CF;

            border: 1px solid rgba(0, 0, 0, .2);

        }

        .un-visited p {

            margin: 0% 167%;

        }

        .testreview {

            margin-left: 26%;
        }

        .testreview table,
        .testreview td,
        .testreview th {

            border:1px solid black;
            border-collapse: collapse;
        }
        .testreview td{
            padding: 2%;
        }

        @media screen and (max-width:600px) {
            .instructions {
                text-align: justify;
                padding: 7% 7% 0% 2%;
            }

            .question-direction {
                display: flex;
                flex-direction: column-reverse;
                margin: 27%;
                justify-content: normal;
            }

            .question-path {
                width: 117%;
                margin-left: -4%;
                gap: 7%;
            }

            .answer-data p {
                width: 105%;
            }

            #counter {
                font-size: 1rem;
                width: 18%;
                margin: 3% 77%;
                padding: 0;
            }

            .close {
                margin-left: 93%;
                border: none;
            }

            .delete-box {
                margin-left: 6%;
            }

            .sm-close {
                position: absolute;
                margin: -12% 55%;
            }

        }

        @media screen and (min-width:700px) and (max-width:800px) {
            .question-path {
                display: grid;
                grid-template-columns: auto auto auto auto;
                text-align: center;
                width: 24%;
                margin-left: 0%;
                gap: 5%;
                height: auto;
            }
        }
    </style>
</head>

<body>

    <!-- submit button -->
    <div class="modal fade" id="take-test-Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" id="media-content">
                <div class="modal-header">
                    <button type="button" class="close" id="close-btn" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="delete-box">
                        <h4>Are you want to Submit a test?</h4>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="delete-btn-yes" data-bs-dismiss="modal" onclick=submit()
                        class="delete-btn-yes btn btn-danger">Yes</button>
                    <button id="delete-btn-no" data-bs-dismiss="modal"
                        class="delete-btn-no btn btn-primary">Back</button>
                </div>
            </div>
        </div>
    </div>


    <h1 class="test-title"></h1>
    <h2 id="counter"></h2>
    <div class="test-container">

        <div class="instructions">
            <ol class="instruction"></ol>

            <p class="text-end"> <button id="start-test-btn" class="btn btn-primary btn-sm">Take Test</button> </p>
        </div>
        <div class="question-container">

        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </div>
    <div class="question-direction">
        <div class="question-path"></div>
        <div class="answer-data"></div>
    </div>
    <div class="testreview"></div>
    <script>
        var host = window.location.protocol + "//" + window.location.host;
        var url = window.location.href;
        var text = url.split('/')
        var token = localStorage.getItem("token")
        var user_type = localStorage.getItem("user_type")
        var student_id = localStorage.getItem("id")
        var id = text.at(-2)
        let subject;
        let grade;
        let question_no = 0;
        let question_list = [];
        let answer_details = []
        let question_paper_id;
        let grade_name;
        let subject_name;
        let remarks;
        let total_marks;
        let duration;
        let pass_percentage;
        let testdetails_list = [];
        let interval;
        let counter_container = document.querySelector('#counter');
        var list = document.querySelector('.instruction');
        //    get function
        $(document).ready(function () {
            var user = localStorage.getItem('user_type')
            if (user != 'is_student' || !token) {
                return window.location.href = '/404';
            }
        })
        function get() {
            if (user_type != 'is_student') {
                return
            }
            var content = ''
            fetch('https://schooltestproject.herokuapp.com/api/instructions/', {
                method: 'GET',
                headers: {
                    'Authorization': 'token' + ' ' + token
                },
            }).then(res => {
                return res.json()
            })
                .then(data => {
                    console.log(data.data)
                    data.data.forEach((d, index) => {
                        console.log(d.note)
                        content += `<li>${d.note}</li>`
                    })
                    list.innerHTML = content;
                })


        }
        get();

        //store test details

        function test_details() {

            fetch(`https://schooltestproject.herokuapp.com/api/test/${id}/`, {
                method: 'GET',
                headers: {
                    'content-Type': 'application/json',
                    'Authorization': 'token' + ' ' + token,
                }
            }).then(res => {
                return res.json()
            }).then(data => {
                console.log(data)
                document.querySelector('.test-title').innerHTML = `${data.remarks}`
                question_paper_id = data.question_paper
                grade_name = data.grade_name;
                subject_name = data.subject_name;
                remarks = data.remarks;
                total_marks = data.marks;
                duration = data.duration;
                pass_percentage = data.pass_percentage;
            })
        }
        test_details();

        // start test function
        document.getElementById('start-test-btn').addEventListener('click', () => {
            document.querySelector('.instructions').innerHTML = ''
            fetch(`https://schooltestproject.herokuapp.com/api/question-paper/${question_paper_id}/`, {
                method: 'GET',
                headers: {
                    'content-Type': 'application/json',
                    'Authorization': 'token' + ' ' + token,
                }
            }).then(res => {
                return res.json()
            }).then(data => {
                console.log(data)

                if (data.status == 'success') {
                    grade = data.data.grade
                    subject = data.data.subject
                    for (let i = 0; i < data.data.no_of_questions.length; i++) {
                        answer_details.push(null)
                    }
                    console.log(answer_details)
                    for (let i = 0; i < data.data.no_of_questions.length; i++) {
                        question_list.push(data.data.no_of_questions[i])
                    }
                    if (data.status == 'success') {
                        //   data.data.no_of_questions.forEach((d, index) => {
                        url2 = new URL(`https://schooltestproject.herokuapp.com/api/test-questions/`);
                        url2.searchParams.append('question_paper', question_paper_id);
                        fetch(url2, {
                            method: 'GET',
                            headers: {
                                'content-Type': 'application/json',
                                'Authorization': 'token' + ' ' + token,
                            }
                        }).then(res => {
                            return res.json()
                        }).then(data => {
                            console.log(data)
                            data.forEach((d, index) => {
                                question_no = index
                                answer_details[question_no] = {
                                    'id': d.id,
                                    'question': d.question,
                                    'question_type': d.question_type,
                                    'correct_answer': d.answers.answer,
                                    'option_a': d.answers.option_a,
                                    'option_b': d.answers.option_b,
                                    'option_c': d.answers.option_c,
                                    'option_d': d.answers.option_d,
                                    'answer': null,
                                    'seen': false,
                                    'mark': d.mark,
                                }
                                if (d.question_type != 'MCQ') {
                                    answer_details[question_no].correct_answer = answer_details[question_no][(answer_details[question_no].correct_answer)]
                                    console.log(answer_details[question_no].correct_answer, answer_details[question_no][(answer_details[question_no].correct_answer)])
                                }
                                // console.log(answer_details)
                                question_no += 1
                                let question_details = answer_details[0]
                                answer_details[0].seen = true;
                                if (question_no == 1) {
                                    let question_content;
                                    if (question_details.question_type == 'MCQ') {
                                        question_content = `<div> 
                       <hr class="hr1"> <p> ${question_no}). ${d.question}</p> 
                        <ol type="a">
                           <li> <input type="radio" class='option_a_${question_details.id}' id="option_a_${question_details.id}" name="answer_${question_details.id}" value='option_a'> ${question_details.option_a}</li>

                            <li>
                                <input type="radio" class='option_b_${question_details.id}' id="option_b_${question_details.id}" name="answer_${question_details.id}" value='option_b'> ${question_details.option_b}</li>

                            <li><input type="radio" class='option_c_${question_details.id}' id="option_c_${question_details.id}" name="answer_${question_details.id}" value='option_c'> ${question_details.option_c}</li>
                            <li><input type="radio" class='option_d_${question_details.id}' id="option_d_${question_details.id}" name="answer_${question_details.id}" value='option_d'> ${question_details.option_d}</li>
                        <hr class="hr2"><ol>
                            </div>

                        <p class='text-end'><button class="btn btn-primary btn-sm" onclick=clear_answer(0)>Clear </button> <button class="btn btn-primary btn-sm" onclick=next(0,1)> Next </button> </p> <button  class="btn btn-success btn-sm" id='submit' data-bs-toggle="modal" data-bs-target="#take-test-Modal">submit</button> </p> `
                                        // console.log()
                                        // console.log(document.querySelector(`input[name="answer_${data.data.id}"]`));
                                        document.querySelector('.question-container').innerHTML = question_content
                                    }
                                    else {
                                        question_content = `<div>   <p> ${question_no}). ${d.question} <input type="text" name="answer_${question_details.id}" id="" class="fib fib_${question_details.id}"> <p>
                                                <p class='text-end'> <button class="btn btn-primary btn-sm" onclick=clear_answer(0)>Clear </button>  <button class="btn btn-primary btn-sm" onclick=next(0,1)> Next </button> </p> <button  class="btn btn-success btn-sm" id='submit' data-bs-toggle="modal" data-bs-target="#take-test-Modal" >submit</button> </p> 
                                                </div>`
                                        document.querySelector('.question-container').innerHTML = question_content
                                    }
                                }
                            })

                        })
                    }
                    first_question(0);
                    d = duration
                    // counter
                    function counter() {

                        let h = Math.floor(d / 3600)
                        let m = Math.floor((d - (Math.floor(d / 3600))) / 60)
                        let s = d - (h * 3600) - (m * 60)
                        h = (h.toString()).padStart(2, '0')
                        m = (m.toString()).padStart(2, '0')
                        s = (s.toString()).padStart(2, '0')
                        if (d == 0) {
                            clearInterval(interval)
                            submit()
                            counter_container.innerHTML = `timeout`
                        } else {
                            d -= 1
                            counter_container.innerHTML = `${h}:${m}:${s}`
                        }

                    }

                    //65
                    interval = setInterval(counter, 1000)
                    //  console.log(interval,'int')
                }
            })
        })

        // prev next

        function next(current, n) {
            let action_number = current
            let question_details = answer_details[n]
            // saving answer

            get_ans_id = answer_details[action_number].id
            var get_ans_fib = document.getElementsByName(`answer_${get_ans_id}`);
            // answer_details[n].answer = get_ans_fib.value
            var get_ans = document.getElementsByName(`answer_${get_ans_id}`);
            let fib_answer = document.querySelector(`.fib_${get_ans_id}`)
            if (fib_answer) {
                console.log(fib_answer.value)
                answer_details[action_number].answer = fib_answer.value
            }

            let question_content = '';
            for (i = 0; i < get_ans.length; i++) {
                if (get_ans[i].checked) {
                    answer_details[action_number].answer = get_ans[i].value;
                }
            }

            if (question_details.question_type != 'MCQ' && question_details.answer) {
                console.log(`.fib_${question_details.id}`)

            }
            let options = ['option_a', 'option_b', 'option_c', 'option_d']

            if (question_details.question_type == 'MCQ') {
                question_content += `<div><p> ${n + 1}). ${question_details.question}</p> 
                        <ol type="a">`
                for (i = 0; i < options.length; i++) {
                    console.log(question_details['option_a'])
                    if (question_details.answer == options[i]) {
                        question_content += `<li><input checked type="radio" id="${options[i]}_${question_details.id}" name="answer_${question_details.id}" value='${options[i]}'> ${question_details[options[i]]}</li>`
                    } else {
                        question_content += `<li><input type="radio" id="${options[i]}_${question_details.id}" name="answer_${question_details.id}" value='${options[i]}'> ${question_details[options[i]]}</li>`
                    }
                }
                question_content += `<ol>
                            </div>
                        `
            } else {
                if (question_details.answer) {
                    question_content = `<div>   <p> ${n + 1}). ${question_details.question}<span class=''> <input type="text" name="answer_${question_details.id}" id="" class="fib fib_${question_details.id}" value='${question_details.answer}'> </span></p> </div>`
                } else {
                    question_content = `<div>   <p> ${n + 1}). ${question_details.question}<span class=''> <input type="text" name="answer_${question_details.id}" id="" class="fib fib_${question_details.id}"> </span></p> </div>`
                }
            }

            if (n == (answer_details.length) - 1) {
                question_content += ` <p class='d-flex justify-content-between mb-3'> <span><button  class="btn btn-primary btn-sm" onclick=next(${n},${n - 1})> Prev </button><button class="btn btn-primary btn-sm" onclick=clear_answer(${n})>Clear </button> </span> <button  class="btn btn-success btn-sm" id='popup' data-bs-toggle="modal" data-bs-target="#take-test-Modal" >submit</button> </p> `
            }
            else if (n == 0) {
                question_content += ` <p class='text-end'><button class="btn btn-primary btn-sm" onclick=clear_answer(${n})>Clear </button>  <button class="btn btn-primary btn-sm" onclick=next(${n},${n + 1})> Next </button> </p>  <button  class="btn btn-success btn-sm" id='submit' data-bs-toggle="modal" data-bs-target="#take-test-Modal" >submit</button> </p> `
            } else {
                question_content += ` <p class='d-flex justify-content-between mb-3'> <span><button class="btn btn-primary btn-sm" onclick=clear_answer(${n})>Clear </button></span> <span ><button class="btn btn-primary btn-sm" onclick=next(${n},${n - 1}) > Prev </button><button class="btn btn-primary btn-sm" onclick=next(${n},${n + 1})  style='margin-left:5px;'> Next </button> </p></span>  <button  class="btn testsubmit btn-success btn-sm" id='submit' data-bs-toggle="modal" data-bs-target="#take-test-Modal" >submit</button> </p> `
            }
            //c16e6e2b-5b79-4a



            document.querySelector('.question-container').innerHTML = question_content


            var choosed_id = question_details.id

            question_details.seen = true;

            // }
            path(n);
        }


        function first_question(current) {
            let content = '';
            for (i = 0; i < answer_details.length; i++) {
                if (i == 0) {
                    content += `<div class="red" onclick=next(${current},${i})> ${i + 1} </div>`
                } else {
                    content += `<div class="grey" onclick=next(${current},${i})> ${i + 1} </div>`
                }
            }
            document.querySelector('.question-path').innerHTML = content
            document.querySelector('.answer-data').innerHTML = `<p> Unvisited questions - ${answer_details.length - 1}</p>
            <p> Answered questions - 0 </p>
            <p> Unanswered questions - 0</p> 
            <div class="color-description"> 
            <div class="answer"><p>Answered</p></div>
            <div class="un-answer"><p>UnAnswered</p></div>
            <div class="un-visited"><p>UnVisited</p></div></div>`
        }
        function path(current) {
            console.log(answer_details.length)
            let content = '';
            let unvisited = 0;
            let unanswered = 0;
            let answered = 0;
            for (i = 0; i < answer_details.length; i++) {
                temp = answer_details[i]
                if (!temp.seen) {
                    content += `<div class="grey" onclick=next(${current},${i})> ${i + 1} </div>`
                    unvisited += 1
                }
                else if (!answer_details[i].answer) {
                    content += `<div class="red" onclick=next(${current},${i})> ${i + 1} </div>`
                    unanswered += 1
                } else {
                    content += `<div class="green" onclick=next(${current},${i})> ${i + 1} </div>`
                    answered += 1
                }
            }
            document.querySelector('.question-path').innerHTML = content
            document.querySelector('.answer-data').innerHTML = `<p> Unvisited  questions - ${unvisited}</p>
            <p> Answered questions - ${answered} </p>
            <p> Unanswered questions - ${unanswered - 1} </p> 
            <div class="answer"><p>Answered</p></div>
            <div class="un-answer"><p>UnAnswered</p></div>
            <div class="un-visited"><p>UnVisited</p></div></div>    
            `
            if (answered === answer_details.length) {
                document.getElementById("submit").style.display = 'block'
            }
        }
        function submit() {
            testdetails_list = []
            counter_container.style.display = 'none'
            console.log(answer_details)
            answer_details.length - 1
            get_ans_id = answer_details[(answer_details.length) - 1].id

            var get_ans_fib = document.getElementsByName(`answer_${get_ans_id}`);
            var get_ans = document.getElementsByName(`answer_${get_ans_id}`);
            let fib_answer = document.querySelector(`.fib_${get_ans_id}`)
            if (fib_answer) {
                console.log(fib_answer.value)
                answer_details[(answer_details.length) - 1].answer = fib_answer.value
            }

            let question_content = '';
            for (i = 0; i < get_ans.length; i++) {
                if (get_ans[i].checked) {
                    answer_details[(answer_details.length) - 1].answer = get_ans[i].value;
                }
            }
            let wrong_answer = 0;
            let correct_answer = 0;
            let unanswered = 0;
            let marks = 0
            console.log('total-mark', total_marks)
            var weight = total_marks / (answer_details.length)

            for (i = 0; i < answer_details.length; i++) {
                if (answer_details[i].answer == answer_details[i].correct_answer) {
                    correct_answer += 1;
                    marks += ((answer_details[i].mark) * weight)
                } else if (answer_details[i].answer) {
                    wrong_answer += 1
                } else {
                    unanswered += 1
                }

            }
            console.log('your marks', marks)


            var score = (marks / total_marks) * 100

            console.log(score)
            score = parseInt(score)
            console.log(score)
            var result;
            if (score < pass_percentage) {
                result = 'fail'
            } else {
                result = 'pass'
            }
            let overallreview = ''
            // testdetails=[]
            console.log(answer_details)
            for (i = 0; i < answer_details.length; i++) {
                if (answer_details[i].question_type != 'MCQ') {
                    testdetails_list.push({ 'question': answer_details[i].question, 'correct_answer': answer_details[i].correct_answer, 'answer': answer_details[i].answer })
                } else {
                    testdetails_list.push({ 'question': answer_details[i].question, 'correct_answer': answer_details[i][`${answer_details[i].correct_answer}`], 'answer': answer_details[i][`${answer_details[i].answer}`] })
                }
            }
            testdetails_list = JSON.stringify(testdetails_list)
            console.log('c', correct_answer, 'u', unanswered, 'w', wrong_answer, score)
            fetch('https://schooltestproject.herokuapp.com/api/test-history/',
                {
                    method: 'POST',
                    body: JSON.stringify({ 'grade': grade, 'subject': subject, 'student_id': student_id, 'test_id': id, 'question_paper': question_paper_id, 'result': result, 'score': score, 'correct_answer': correct_answer, 'wrong_answer': wrong_answer, 'unanswered_questions': unanswered, 'test_detail': testdetails_list }
                    ),
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Authorization': 'token' + ' ' + token,
                    },
                }).then(function (response) {
                    if (response.status == 201) {
                        console.log("Sucess response", response)
                        // get();
                    } else {
                        console.log(response);
                    }
                    return response.json()
                }).then(data => {
                    console.log(data)
                    document.querySelector('.question-container').innerHTML = `<p class='text-success text-center '>Test submitted successfully<button class='btn btn-primary btn-sm ' onclick=redirect()>close</button></p>
                    <p> Result : ${result} </p>
                    <p> Score : ${score} </p>
                    
                    `
                    document.querySelector('.question-direction').innerHTML = ''
                    if (data.status != 'success') {
                        console.log(data)
                    } else {
                        overallreview += `<table class='overallreview'>
                            <tr>
                                <th >Question</th>
                                <th >Correct Answer</th>
                                <th>Given Answer</th>
                            </tr>`
                        for (i = 0; i < answer_details.length; i++) {
            
                            if (answer_details[i].question_type != 'MCQ') {
                                if (answer_details[i][`${answer_details[i].correct_answer}`] == answer_details[i].answer) {
                                    overallreview += `<tr><td>${answer_details[i].question}</td>` + `<td>${answer_details[i][`${answer_details[i].correct_answer}`]}</td>` + `<td>${answer_details[i].answer}</td></tr>`
                                }
                                else {
                                    overallreview += `<tr><td>${answer_details[i].question}</td>` + `<td>${answer_details[i][`${answer_details[i].correct_answer}`]}</td>` + `<td>${answer_details[i].answer}</td></tr>`
                                }
                            }
                            else {
                                if (answer_details[i][`${answer_details[i].correct_answer}`] == answer_details[i][`${answer_details[i].answer}`]) {
                                    overallreview += `<tr ><td>${answer_details[i].question}</td>` + `<td>${answer_details[i][`${answer_details[i].correct_answer}`]}</td>` `<td>${answer_details[i][`${answer_details[i].answer}`]}</td>`
                                }
                                else {
                                    overallreview += `<tr><td>${answer_details[i].question}</td>` + `<td>${answer_details[i][`${answer_details[i].correct_answer}`]}</td>` + `<td>${answer_details[i][`${answer_details[i].answer}`]}</td>`
                                }

                            }
                        }
                    }
                    clearInterval(interval)
                    // counter_container.innerHTML = ''
                    document.querySelector('.testreview').innerHTML = overallreview + `</table>`
                })
        }


        function clear_answer(index) {
            let question_details = answer_details[index]
            console.log(index)
            get_ans_id = answer_details[index].id
            var get_ans_fib = document.getElementsByName(`answer_${get_ans_id}`);
            var get_ans = document.getElementsByName(`answer_${get_ans_id}`);
            if (question_details.question_type == 'MCQ') {
                for (i = 0; i < get_ans.length; i++) {
                    if (get_ans[i].checked) {
                        answer_details[index].answer = null;
                        get_ans[i].checked = false;
                    }

                }
            }
            else {
                document.querySelector(`.fib_${question_details.id}`).value = ''
            }

        }
        function redirect() {
            window.location.href = `${host}/test-history`
        }

    </script>
</body>

</html>