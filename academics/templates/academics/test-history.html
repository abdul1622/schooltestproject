{% extends 'base.html' %}
{% block history %}
<h1 class="test-history">Test History</h1>
<div class="history"></div>
<script>
   var  student_id=localStorage.getItem('id')
   var token=localStorage.getItem('token')
   var standard = localStorage.getItem('standard')
   let content = ''
   url = new URL('https://schooltestproject.herokuapp.com/api/test-history/');
    url.searchParams.append('grade', standard);
    url.searchParams.append('studentid',student_id)
    fetch(url,
    {
        method: 'GET',
        
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
            'Authorization': 'token' + ' ' + token,
        },
    }).then(function (response) {
        return response.json()
    }).then(data => {
        data.forEach((d, index) =>{
            let test_id = d.test_id
            fetch(`https://schooltestproject.herokuapp.com/api/test/${test_id}/`,
            {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Authorization': 'token' + ' ' + token,
              },
            }).then(response => {
              if (response.status == 200) {
                console.log("Sucess response", response);
                // test_messages.innerHTML = `<p class="text-success"> ${form_remarks} test created successfully</p>`;
                // test_errors.innerHTML = ''

              }
              return response.json();
            }).then(function (test_data) {
              console.log(test_data)
              console.log(d)
              if(d.result != 'fail'){
                content += `<div style="background-color:green;">`
              }else{
              content += '<div>'
              }
              content += `<p class="text-center">${test_data.remarks}</p>`
              content += `<p> Correct Answer : ${d.correct_answer}</p>
              <p>Wrong Answers : ${d.wrong_answer}</p>
              <p>Un Answered : ${d.unanswered_questions}</p>
              <p>Result : ${d.result}</p>
              <p>Score : ${d.score} %</p>
              <p>Date : ${d.created_at.slice(0, 10)} </p>
              <p>Time : ${d.created_at.slice(11,16)} </p>
          </div>  `
          
        }).then(()=>{
            document.querySelector('.history').innerHTML=content
        })

        
    })
})
</script>
{% endblock %}