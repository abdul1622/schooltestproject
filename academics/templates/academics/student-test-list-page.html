{% extends "base.html" %}
{% block content %}
<div class="header">
    <h2 class="text-center">Grade - <span id="grade-head"></span></h2>
    <hr>
  </div>
<div class="test-list">

</div>
<div class="messages container-fluid">

</div>
<div class="error-messages container-fluid">

</div>

<script>
    var token = localStorage.getItem('token')
    let messages = document.querySelector('.messages')
    let error_messages = document.querySelector('.error-messages')
    let head = document.querySelector('.header')
    let history=[]
    head.style.display = 'none'
    let set_id = false
    url = 'https://schooltestproject.herokuapp.com/api/test/'
    var container = document.querySelector('.test-list')

  fetch('https://schooltestproject.herokuapp.com/api/test-history/',
            {
                method: 'GET',
                headers: {
                    'Authorization': 'token' + ' ' + token,
                },
            }).then(function (response) {
                return response.json()
            }).then(data => {
                console.log(data)
                console.log(data.length)
                for (i = 0; i < data.length; i++) {
                  history.push(data[i])
                }

                if (data.status != 'success') {
                console.log(data)
                }
            })
            console.log(history)
function get_user_standard() {
        fetch('https://schooltestproject.herokuapp.com/api/profile/', {
      method: 'GET',
      headers: {
        'content-Type': 'application/json',
        'Authorization': 'token' + ' ' + token,
      }
    }).then(res => {
      return res.json()
    }).then(data => {
      let user_type = data.data.user_type
      let standard = data.data.profile.standard
      console.log(standard)
      console.log(user_type,standard)
      if(user_type != 'is_student'){
        messages.innerHTML = `<p class='test-warning'>sorry you don't have a access do this page</p>`
        
        
        return
      }
    //   return standard
    get_test(standard);
    })
    
    }

    get_user_standard();
function get_test(standard){
    if(standard){
        head.style.display = 'block';
        document.getElementById('grade-head').textContent = `${standard}`
        let content = '';
        url2 = new URL('https://schooltestproject.herokuapp.com/api/subject-list/');
        url2.searchParams.append('grade', standard);
        fetch(url2, {
      method: 'GET',
      headers: {
        'content-Type': 'application/json',
        'Authorization': 'token' + ' ' + token,
      }
    }).then(res => {
      return res.json()
    }).then(data => {
        data.forEach((d, index) => {
    //    if(d.grade_name = standard){
          let flag=true
          for (i = 0; i < history.length; i++) {
           if ( history[i].test_id == d.id ){
            flag=false
           }
          }
          if (flag==true){
            content = content + `<div class="questions-paper-card" id='${d.id}'>
<p> Subject : <span class="subject"> ${d.subject_name}<span></p>
<p > Remarks : <span class="remarks">${d.remarks}</span></p>

<p > Marks : <span class="marks">${d.marks}</span></p>

<p> Duration : ${d.duration} </p>

<p> Description : ${d.description} </p>`
if(d.test_id){
  content += `Test ID - ${d.test_id}`
}else{
content +=
`<p class='text-right'><button class='btn btn-primary btn-sm' onclick=take(${d.id})>take test</button></p> 
</div>`
}
}
//}

    })
    container.innerHTML = content;
    })
}
}

function take(id){
  console.log('sjfd')
  window.location.href = window.location.protocol + "//" + window.location.host + '/take-test/' + + id +'/';
}

</script>
{% endblock %}