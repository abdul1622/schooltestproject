<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <style>
    .navbar {
      border-radius: none;
      background-color: #E9D5DA;


    }

    .navbar a {
      color: black;
      text-decoration: none;
    }

    #login {
      width: 120px;
      border-radius: 5px;
      outline: none;
      border: none;
      margin-left: 160px;
    }

    input[type=file] {
      border: none;
      margin-left: 116px;
      margin-top: -9px;
      position: absolute;
    }

    .profile {
      margin-top: 200px;
      margin-left: 600px;
      font-size: 25px;
      font-family: Arial, Helvetica, sans-serif;
    }

    table a {
      text-decoration: none;
      color: rgba(0, 0, 0, 0.63);
    }

    table a:hover {
      text-decoration: none;
      color: rgba(0, 0, 0, 0.63);
    }

    td,
    th {
      border: 1px solid #dddddd;
      color: rgba(0, 0, 0, 0.63);
      padding: 8px;
      font-size: 18px;
      text-align: center;
    }

    li {
      padding-left: 10px;
      font-size: 18px;
      display: inline;
      text-align: left;
      text-transform: uppercase;
      padding-right: 10px;
      color: #ffffff;
    }

    h1 {
      color: #ffffff;
      font-size: 35px;
      font-weight: 300;
      text-align: center;


    }

    table {
      font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
      width: 100%;
    }


    th {
      background-color: #4D4C7D;
      color: white;
    }

    .user {
      background-color: bisque;
      font-size: 20px;
      margin-bottom: 50px;
      width: 400px;
    }
  </style>


</head>

<body>
  <nav class="navbar navbar-expand-lg ">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">School</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="accounts/webprofile" onclick=" profile()">Profile</a>
          </li>
          <li class="nav-item">
            <a href="#" onclick="logout()">Signout</a>
          </li>
          <li class="nav-item">
            <a href="#">Edit</a>
          </li>

          <li class="nav-item">
            <a href="#" onclick="userdetails()">userdetails
            </a>
          </li>
        </ul>
      </div>
      <p></p>
    </div>
  </nav>
   <div class="userDetails">
   <input type="text" placeholder="Email"> 
   <input type="text" placeholder="Phone"> 
   <input type="text" placeholder="Reg"> 
   <input type="text" placeholder="DOB"> 
   <input type="text" placeholder="Standard"> 
   <input type="text" placeholder="Section"> 
   <input type="text" placeholder="First Name"> 
   <input type="text" placeholder="Last Name"> 
   <input type="text" placeholder="Full Name"> 
   <input type="file"> 

   </div>
  {% block content %}{% endblock %}
  {% block user %}{% endblock %}
  <div class="container"></div>
  <script>
    const container = document.querySelector('.container');
    function userdetails() {
      let token = localStorage.getItem("token")
      console.log(token)
      fetch('https://schooltestproject.herokuapp.com/auth/user-details/', {
        method: 'GET',
        headers: new Headers({
          'Authorization': 'token' + ' ' + token,
          'Content-Type': 'application/json'
        })
      }).then(res => {
        return res.json()
      }).then(data => {
        console.log('data', data)
        let htmlSegment = ''
        data.forEach((d, index) => {
          htmlSegment = htmlSegment + `<div class="user">
            <p class="email">${d.email}</p>
            <p class="phone">${d.phone}</p>
          <p   class="fullname">${d.profile?.full_name}</p>
         <p   class="firstname">${d.profile?.first_name}</p>
         <p   class="lastname">${d.profile?.last_name}</p>
           <p class="DOB">${d.date_of_birth}</p>
           <p class="reg">${d.register_number}</p>
           <p class="standard">${d.profile?.standard}</p>
           <p class="section">${d.profile?.section}</p>
           <p class="address">${d.profile?.address}</p>
                <a href=#" id='edit'>Edit</a>&nbsp<a href="#" >Delete</a></div>`
        });

        
        console.log(container)
        container.innerHTML = htmlSegment;

      })
    }
    
    function profile() {
      let token = localStorage.getItem('token')
      console.log(token)
      fetch('https://schooltestproject.herokuapp.com/auth/profile/', {
        method: 'GET',
        headers: new Headers({
          'Authorization': 'token' + ' ' + token,
          'Content-Type': 'application/x-www-form-urlencoded'
        })
      })
        .then(response => response.json())
        .then(data => {
          console.log("data=", data.data.email)
          console.log("data=", data)

          let htmlSegment = `<div class="user">
                 <div class="email"><p>${data.data.email}</p></div>
                 <div class="phone"><p>${data.data.phone}</p></div>
                 <div class="fullname"><p>${data.data.profile.full_name}</p></div>
                 <div class="firstname"><p>${data.data.profile.first_name}</p></div>
                 <div class="lastname"><p>${data.data.profile.last_name}</p></div>
                 <div class="DOB"><p>${data.data.date_of_birth}</p></div>
                 <div class="reg"><p>${data.data.register_number}</p></div>
                 </div>`;
          let container = document.querySelector('.container');
          container.innerHTML = htmlSegment;
        }
        )
    }
      container.addEventListener('click',(e) => {
      form_subject = document.getElementById('id_subject')
      form_chapter_no = document.getElementById('id_chapter_no')
      form_name = document.getElementById('id_name')
      form_description = document.getElementById('id_description');
      chapter_btn = document.getElementById('chapter-btn')
      e.preventDefault();
      let delbutton = e.target.id == 'delete';
      let editbutton = e.target.id == 'edit';
      let id = e.target.parentElement.parentElement.id
      console.log(e.target.parentElement.parentElement.id)
      if(delbutton){
        fetch(`${url}${id}/`,{
          method : 'DELETE',
        }).then(res => res.json()).then(() => location.reload())
      }
    
      if(editbutton){
        const parent = e.target.parentElement.parentElement;
        let email = parent.querySelector(".email").textContent;
        let phone= parent.querySelector('.phone').textContent;
        let reg = parent.querySelector('.reg').textContent;
        let dob = parent.querySelector('.DOB').textContent;
        let fullname = parent.querySelector('.fullname').textContent;
        let lastname= parent.querySelector('.lastname').textContent;
        let firstname= parent.querySelector('.firstname').textContent;
        let standard= parent.querySelector('.standard').textContent;
        let section= parent.querySelector('.section').textContent;
        let address= parent.querySelector('.address').textContent;
        document.getElementById('Email').value='hi' 
        document.getElementById('Phone')=phone
        document.getElementById('Reg')=reg
        document.getElementById('DOB')=dob
        document.getElementById('Full Name')=fullname
        document.getElementById('Last Name')=lastname
        document.getElementById('First Name')=firstname
        document.getElementById('Standard')=standard
        document.getElementById('Section')=section
    

    
        chapter_btn.addEventListener('click',()=>{
          console.log(
            "mfmgngne"
          )
          fetch(`${url}${id}/`,{
            method : 'PUT',
            headers : {
              'content-Type' : 'application/json'
            },
            body: JSON.stringify({ 'subject' : form_subject.value,
            'chapter_no': form_chapter_no.value,
            'name' : form_name.value,
            'description': form_description.value,
          })
        }).then(res => res.json()).then(()=> location.reload())
      }) 
    }
  
  });
    function logout() {
      let token = localStorage.getItem("token")
      console.log(token)
      fetch('https://schooltestproject.herokuapp.com/auth/logout/',
        {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'token' + ' ' + token,
            // 'Content-Type': 'application/x-www-form-urlencoded',
          }
        }).then(response => response.json())

      window.location.href = 'websimplelogin'
    }


  </script>
</body>

</html>